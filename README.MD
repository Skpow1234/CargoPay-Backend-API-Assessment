# CargoPay Backend API Assessment ğŸš€

## **ğŸ“Œ Project Overview**

CargoPay-Backend-API-Assessment is a **RESTful API** built with **ASP.NET Core 8**, designed to manage a **card-based payment system**. It provides functionalities for card creation, payments, balance retrieval, and authentication. The project follows **Clean Architecture principles** and has been fully implemented to meet the requirements outlined in the provided assessment document.

âœ… **Assessment Completion: 100%** ğŸ‰

---

## **ğŸ“¢ Features**

### **âœ… Card Management Module (60K Points)**

- [x] **Create a Card** with a **15-digit card number** and initial balance.
- [x] **Make a Payment** with fee calculations applied dynamically.
- [x] **Retrieve Card Balance** by card number or card ID.
- [x] **Get All Cards** with detailed information.
- [x] **Recharge Card Balance** securely.
- [x] **Delete a Card** (Restricted to Admins).

### **âœ… Payment Fees Module (40K Points)**

- [x] **Implemented Universal Fees Exchange (UFE) Singleton**.
- [x] **Fee updates dynamically every hour.**
- [x] **Thread-safe fee retrieval** to avoid race conditions.
- [x] **Applied fee dynamically to every payment transaction.**

### **âœ… Bonus Features (30K Points)**

- [x] **Performance Optimization** using **caching for balance retrieval**.
- [x] **JWT Authentication & Authorization** with **Role-Based Access Control (RBAC)**.
- [x] **Swagger API Documentation Enabled** for easy testing.
- [x] **Thread-Safe Shared Resources** for handling concurrency.

---

## **ğŸ› ï¸ Installation & Setup**

### **1ï¸âƒ£ Clone the Repository**

```sh
git clone https://github.com/Skpow1234/CargoPay-Backend-API-Assessment.git
cd CargoPay-Backend-API-Assessment
```

### **2ï¸âƒ£ Configure Environment Variables**

Create an **appsettings.json** file in `CargoPay.Presentation`:

```json
{
  "Jwt": {
    "Key": "YOUR_SECRET_KEY_HERE",
    "Issuer": "CargoPayIssuer",
    "Audience": "CargoPayAudience"
  },
  "ConnectionStrings": {
    "DefaultConnection": "Server=YOUR_SERVER;Database=CargoPayDB;Trusted_Connection=True;"
  }
}
```

### **3ï¸âƒ£ Run Database Migrations**

```sh
dotnet ef database update --project CargoPay.Infrastructure --startup-project CargoPay.Presentation
```

### **4ï¸âƒ£ Build & Run the Project**

```sh
dotnet build
dotnet run --project CargoPay.Presentation
```

---

## **ğŸ“– API Documentation**

ğŸ“Œ **Swagger UI is available at:**  
ğŸ‘‰ `http://localhost:5000/swagger`

### **ğŸ›¡ï¸ Authentication (JWT)**

#### ğŸ”¹ `POST /api/auth/login`

```json
{
  "username": "admin",
  "password": "password"
}
```

ğŸ“Œ **Returns a JWT Token** for authentication.

### **ğŸ’³ Card Management**

#### ğŸ”¹ `POST /api/cards/create`

```json
{
  "cardNumber": "123456789012345",
  "balance": 100.00
}
```

```json
ğŸ“Œ Creates a new card.

 ğŸ”¹ `POST /api/cards/pay`

```

```json
{
  "cardNumber": "123456789012345",
  "amount": 50.00
}
```

ğŸ“Œ **Processes a payment and applies a dynamic fee.**

#### ğŸ”¹ `GET /api/cards/by-number/{cardNumber}/balance`

ğŸ“Œ **Retrieves the current balance of a card.**

#### ğŸ”¹ `GET /api/cards/cards`

ğŸ“Œ **Retrieves all registered cards.**

### **ğŸ”‹ Payment Fees & Transactions**

#### ğŸ”¹ `GET /api/fees/current`

ğŸ“Œ **Retrieves the current transaction fee.**

#### ğŸ”¹ `POST /api/cards/recharge-balance`

```json
{
  "cardNumber": "123456789012345",
  "amount": 20.00
}
```

ğŸ“Œ **Recharges the balance of a card.**

#### ğŸ”¹ `DELETE /api/cards/{id}` *(Admin Only)*

ğŸ“Œ **Deletes a card (Restricted to Admin users).**

---

## **ğŸ”’ Security & Authentication**

- Uses **JWT Authentication** for secure access.
- Implements **Role-Based Access Control (RBAC)** (Admin/User roles).
- Protects **critical endpoints with `[Authorize(Roles = "Admin")]`**.

---

## **ğŸ› ï¸ Technologies Used**

- **.NET 8 (ASP.NET Core Web API)** ğŸš€
- **Entity Framework Core + SQL Server** ğŸ—„ï¸
- **FluentValidation** for request validation âœ…
- **JWT Authentication** ğŸ”
- **Background Services (`FeeUpdateService`)** for fee updates â³
- **Swagger** for API Documentation ğŸ“œ
- **Caching (IMemoryCache)** for performance optimization âš¡
- **Clean Architecture Principles** ğŸ—ï¸

---

ğŸ› ï¸ Docker Setup (For Investigation Purposes)

ğŸ“Œ This section is NOT part of the assessment but is included for investigation purposes.

```bash
1ï¸âƒ£ Build & Run Using Docker Compose

docker-compose up --build -d

2ï¸âƒ£ Verify Running Containers

docker ps

3ï¸âƒ£ Check API Logs

docker logs -f cargo-pay-api

4ï¸âƒ£ Stop & Remove Containers

docker-compose down
```

---

## **ğŸ“Œ Conclusion**

âœ… **CargoPay-Backend-API-Assessment is 100% complete!** ğŸ¯
âœ… **Fully meets all assessment requirements.** ğŸ†
âœ… **Includes all bonus optimizations.** ğŸ”¥
